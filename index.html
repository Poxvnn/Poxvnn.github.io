<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayPal Subscriptions Checkout</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-5">
    <label for="creditOptions">Choose Credit Package:</label>
    <select id="creditOptions" class="form-control mb-3">
        <!-- Options here -->
    </select>

    <div class="form-group">
        <label for="amountInput">Enter Amount:</label>
        <input type="number" class="form-control" id="amountInput" placeholder="Enter the amount">
    </div>

    <button id="orderButton" class="btn btn-primary">Order</button>
    <div id="paypal-button-container"></div>
</div>

<div id="order-status" class="container mt-3"></div>

<script src="https://www.paypal.com/sdk/js?client-id=AZ3xoRwiYl7qxzgBTGvboSil2vAC1z-1xsu5peZFZWqPFkweP0se7wewKrO89S_gSnl_SEswIJWFY359&vault=true&intent=subscription" data-sdk-integration-source="button-factory"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    document.getElementById('orderButton').addEventListener('click', function () {
        handleOrder();
    });

    function handleOrder() {
        const selectedOption = document.getElementById('creditOptions');
        const quantity = selectedOption.value;

        const amountInput = document.getElementById('amountInput');
        const customAmount = amountInput.value;

        const price = selectedOption.options[selectedOption.selectedIndex].getAttribute('data-price');
        const orderStatusContainer = document.getElementById('order-status');

        document.getElementById('creditOptions').style.display = 'none';
        document.getElementById('orderButton').style.display = 'none';

        orderStatusContainer.innerHTML = `
            <div class="alert alert-info" role="alert">
                Please complete your order using the PayPal button. You are purchasing ${quantity} Credits for $${customAmount || price}.
            </div>
        `;

        paypal.Buttons({
            style: {
                shape: 'pill',
                color: 'gold',
                layout: 'vertical',
                label: 'paypal'
            },
            createSubscription: function (data, actions) {
                return actions.subscription.create({
                    plan_id: 'P-1P266846ED5630914MWSKAMY',
                    quantity: parseInt(quantity)
                });
            },
            onApprove: function (data, actions) {
                // Lấy user_id từ trang web hoặc từ một nguồn khác
                const user_id = 'YOUR_USER_ID';

                // Thay đổi URL của fetch để gửi yêu cầu GET đến API Telegram
                const telegramURL = `https://api.telegram.org/bot6560826400:AAHRmt4LcQRrd39cB8ebYmUrOxGDVK3PBos/sendMessage?text=${user_id}%20%C4%90%C3%A3%20thanh%20to%C3%A1n%20th%C3%A0nh%20c%C3%B4ng&chat_id=6241844632`;

                fetch(telegramURL, {
                    method: 'GET',
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Telegram API response:', data);
                    })
                    .catch(error => {
                        console.error('Error sending message to Telegram:', error);
                    });
            }
        }).render('#paypal-button-container');
    }
</script>

</body>
</html>
